# ç‰ˆæœ¬å·æ›´æ–°æ ‡å‡†æµç¨‹

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº† Interactive Feedback MCP é¡¹ç›®çš„ç‰ˆæœ¬å·æ›´æ–°æ ‡å‡†æµç¨‹ï¼Œç¡®ä¿æ‰€æœ‰ç›¸å…³æ–‡ä»¶å’Œç³»ç»Ÿç»„ä»¶çš„ç‰ˆæœ¬å·ä¿æŒä¸€è‡´ã€‚

## ğŸ¯ ç‰ˆæœ¬å·æ ¼å¼

é‡‡ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ (Semantic Versioning)ï¼š`MAJOR.MINOR.PATCH[.HOTFIX]`

- **MAJOR**: é‡å¤§å˜æ›´ï¼Œä¸å‘åå…¼å®¹
- **MINOR**: æ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹
- **PATCH**: Bugä¿®å¤ï¼Œå‘åå…¼å®¹
- **HOTFIX**: ç´§æ€¥ä¿®å¤ï¼ˆå¯é€‰ï¼Œå¦‚ 1.2.6.1ï¼‰

## ğŸ“ ç‰ˆæœ¬å·æ›´æ–°æ£€æŸ¥æ¸…å•

### âœ… å¿…é¡»æ›´æ–°çš„æ–‡ä»¶

1. **pyproject.toml** - é¡¹ç›®é…ç½®æ–‡ä»¶
   ```toml
   [project]
   version = "1.2.6.1"
   ```

2. **uv.lock** - ä¾èµ–é”å®šæ–‡ä»¶
   ```toml
   [[package]]
   name = "interactive-feedback-mcp"
   version = "1.2.6.1"
   ```

3. **feedback_ui.py** - å¤‡ç”¨ç‰ˆæœ¬å·
   ```python
   def get_app_version() -> str:
       # æœ€ç»ˆå¤‡ç”¨å€¼
       return "1.2.6.1"  # å¿…é¡»æ›´æ–°è¿™é‡Œ
   ```

### âœ… è‡ªåŠ¨æ›´æ–°çš„ç»„ä»¶

- **åŒ…å…ƒæ•°æ®**: é€šè¿‡é‡æ–°å®‰è£…åŒ…è‡ªåŠ¨æ›´æ–°
- **ç•Œé¢æ˜¾ç¤º**: é€šè¿‡ `get_app_version()` å‡½æ•°è‡ªåŠ¨è·å–

## ğŸ”„ æ ‡å‡†æ›´æ–°æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šæ›´æ–°ç‰ˆæœ¬å·æ–‡ä»¶

```bash
# 1. æ›´æ–° pyproject.toml
sed -i 's/version = ".*"/version = "NEW_VERSION"/' pyproject.toml

# 2. æ›´æ–° uv.lock ä¸­çš„ç‰ˆæœ¬å·
sed -i 's/version = ".*"/version = "NEW_VERSION"/' uv.lock

# 3. æ›´æ–° feedback_ui.py ä¸­çš„å¤‡ç”¨ç‰ˆæœ¬å·
# æ‰‹åŠ¨ç¼–è¾‘æˆ–ä½¿ç”¨ sed å‘½ä»¤
```

### ç¬¬äºŒæ­¥ï¼šæäº¤ç‰ˆæœ¬å·æ›´æ–°

```bash
# æäº¤ç‰ˆæœ¬å·æ–‡ä»¶æ›´æ–°
git add pyproject.toml uv.lock interactive_feedback_mcp/feedback_ui.py
git commit -m "å‡çº§ç‰ˆæœ¬åˆ° vNEW_VERSION

- æ›´æ–° pyproject.toml ç‰ˆæœ¬å·
- æ›´æ–° uv.lock ç‰ˆæœ¬å·  
- æ›´æ–°å¤‡ç”¨ç‰ˆæœ¬å·"

# æ¨é€åˆ°è¿œç¨‹
git push origin main
```

### ç¬¬ä¸‰æ­¥ï¼šé‡æ–°å®‰è£…åŒ…

```bash
# é‡æ–°å®‰è£…åŒ…ä»¥æ›´æ–°å…ƒæ•°æ®
uv pip install -e .

# éªŒè¯ç‰ˆæœ¬å·
python -c "
import sys
sys.path.insert(0, 'interactive_feedback_mcp')
from feedback_ui import get_app_version
print(f'å½“å‰ç‰ˆæœ¬å·: {get_app_version()}')
"
```

### ç¬¬å››æ­¥ï¼šåˆ›å»ºå’Œæ¨é€ Git Tag

```bash
# åˆ›å»ºå¸¦æ³¨é‡Šçš„ tag
git tag -a vNEW_VERSION -m "vNEW_VERSION - ç‰ˆæœ¬æè¿°

ä¿®å¤/æ–°å¢å†…å®¹ï¼š
- åŠŸèƒ½1
- åŠŸèƒ½2
- Bugä¿®å¤

ç‰ˆæœ¬æ›´æ–°ï¼š
- æ›´æ–°æ‰€æœ‰ç‰ˆæœ¬å·æ–‡ä»¶
- éªŒè¯ç‰ˆæœ¬å·æ˜¾ç¤ºæ­£ç¡®"

# æ¨é€ tag åˆ°è¿œç¨‹
git push origin vNEW_VERSION
```

## âš ï¸ å¸¸è§é”™è¯¯å’Œé¿å…æ–¹æ³•

### é”™è¯¯1ï¼šå¿˜è®°æ›´æ–°å¤‡ç”¨ç‰ˆæœ¬å·
**é—®é¢˜**: ç•Œé¢æ˜¾ç¤ºæ—§ç‰ˆæœ¬å·
**è§£å†³**: å¿…é¡»æ›´æ–° `feedback_ui.py` ä¸­çš„ç¡¬ç¼–ç å¤‡ç”¨å€¼

### é”™è¯¯2ï¼šæ²¡æœ‰é‡æ–°å®‰è£…åŒ…
**é—®é¢˜**: åŒ…å…ƒæ•°æ®ç‰ˆæœ¬å·è¿‡æ—¶
**è§£å†³**: æ‰§è¡Œ `uv pip install -e .` é‡æ–°å®‰è£…

### é”™è¯¯3ï¼šç‰ˆæœ¬å·ä¸ä¸€è‡´
**é—®é¢˜**: ä¸åŒæ–‡ä»¶ä¸­ç‰ˆæœ¬å·ä¸åŒ¹é…
**è§£å†³**: ä½¿ç”¨æ£€æŸ¥æ¸…å•ç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½æ›´æ–°

### é”™è¯¯4ï¼šå…ˆåˆ›å»º tag å†æ›´æ–°ç‰ˆæœ¬å·
**é—®é¢˜**: tag æŒ‡å‘é”™è¯¯çš„æäº¤
**è§£å†³**: ä¸¥æ ¼æŒ‰ç…§æµç¨‹é¡ºåºæ‰§è¡Œ

## ğŸ” ç‰ˆæœ¬å·éªŒè¯

### è‡ªåŠ¨éªŒè¯è„šæœ¬

```bash
#!/bin/bash
# version_check.sh - éªŒè¯ç‰ˆæœ¬å·ä¸€è‡´æ€§

echo "ğŸ” æ£€æŸ¥ç‰ˆæœ¬å·ä¸€è‡´æ€§..."

# ä» pyproject.toml è¯»å–ç‰ˆæœ¬å·
PYPROJECT_VERSION=$(grep 'version = ' pyproject.toml | sed 's/.*version = "\(.*\)".*/\1/')
echo "ğŸ“„ pyproject.toml: $PYPROJECT_VERSION"

# ä» uv.lock è¯»å–ç‰ˆæœ¬å·
UVLOCK_VERSION=$(grep -A2 'name = "interactive-feedback-mcp"' uv.lock | grep 'version = ' | sed 's/.*version = "\(.*\)".*/\1/')
echo "ğŸ”’ uv.lock: $UVLOCK_VERSION"

# ä»ä»£ç è¯»å–å¤‡ç”¨ç‰ˆæœ¬å·
BACKUP_VERSION=$(grep 'return ".*"' interactive_feedback_mcp/feedback_ui.py | tail -1 | sed 's/.*return "\(.*\)".*/\1/')
echo "ğŸ’¾ å¤‡ç”¨ç‰ˆæœ¬å·: $BACKUP_VERSION"

# ä»åŒ…å…ƒæ•°æ®è¯»å–ç‰ˆæœ¬å·
PACKAGE_VERSION=$(python -c "from importlib import metadata; print(metadata.version('interactive-feedback-mcp'))" 2>/dev/null || echo "æœªå®‰è£…")
echo "ğŸ“¦ åŒ…å…ƒæ•°æ®: $PACKAGE_VERSION"

# æ£€æŸ¥ä¸€è‡´æ€§
if [ "$PYPROJECT_VERSION" = "$UVLOCK_VERSION" ] && [ "$PYPROJECT_VERSION" = "$BACKUP_VERSION" ]; then
    echo "âœ… ç‰ˆæœ¬å·ä¸€è‡´: $PYPROJECT_VERSION"
else
    echo "âŒ ç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼"
    exit 1
fi
```

## ğŸ“š ç‰ˆæœ¬å·è¯»å–é€»è¾‘

```python
def get_app_version() -> str:
    """ç‰ˆæœ¬å·è¯»å–ä¼˜å…ˆçº§ï¼š
    1. å·²å®‰è£…åŒ…å…ƒæ•°æ® (metadata.version)
    2. pyproject.toml æ–‡ä»¶è§£æ
    3. ç¡¬ç¼–ç å¤‡ç”¨å€¼
    """
    try:
        # ä¼˜å…ˆçº§1: åŒ…å…ƒæ•°æ®
        return metadata.version("interactive-feedback-mcp")
    except metadata.PackageNotFoundError:
        try:
            # ä¼˜å…ˆçº§2: pyproject.toml
            import tomllib
            pyproject_path = os.path.join(os.path.dirname(__file__), "..", "pyproject.toml")
            if os.path.exists(pyproject_path):
                with open(pyproject_path, "rb") as f:
                    data = tomllib.load(f)
                return data["project"]["version"]
        except Exception:
            pass
    
    # ä¼˜å…ˆçº§3: å¤‡ç”¨å€¼ï¼ˆå¿…é¡»æ‰‹åŠ¨æ›´æ–°ï¼‰
    return "1.2.6.1"
```

## ğŸš€ å¿«é€Ÿæ›´æ–°å‘½ä»¤

```bash
# ä¸€é”®æ›´æ–°ç‰ˆæœ¬å·ï¼ˆæ›¿æ¢ NEW_VERSION ä¸ºå®é™…ç‰ˆæœ¬å·ï¼‰
NEW_VERSION="1.2.7"

# æ›´æ–°æ–‡ä»¶
sed -i "s/version = \".*\"/version = \"$NEW_VERSION\"/" pyproject.toml
sed -i "/name = \"interactive-feedback-mcp\"/,/version = / s/version = \".*\"/version = \"$NEW_VERSION\"/" uv.lock
sed -i "s/return \".*\"/return \"$NEW_VERSION\"/" interactive_feedback_mcp/feedback_ui.py

# æäº¤å’Œæ¨é€
git add pyproject.toml uv.lock interactive_feedback_mcp/feedback_ui.py
git commit -m "å‡çº§ç‰ˆæœ¬åˆ° v$NEW_VERSION"
git push origin main

# é‡æ–°å®‰è£…åŒ…
uv pip install -e .

# åˆ›å»ºå’Œæ¨é€ tag
git tag -a "v$NEW_VERSION" -m "v$NEW_VERSION - ç‰ˆæœ¬æ›´æ–°"
git push origin "v$NEW_VERSION"

echo "âœ… ç‰ˆæœ¬å·æ›´æ–°å®Œæˆ: $NEW_VERSION"
```

## ğŸ“‹ å‘å¸ƒå‰æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ç‰ˆæœ¬å·åœ¨æ‰€æœ‰æ–‡ä»¶ä¸­ä¸€è‡´
- [ ] åŒ…é‡æ–°å®‰è£…æˆåŠŸ
- [ ] ç•Œé¢æ˜¾ç¤ºæ­£ç¡®ç‰ˆæœ¬å·
- [ ] Git tag åˆ›å»ºå¹¶æ¨é€
- [ ] æ›´æ–°æ—¥å¿—å·²è®°å½•
- [ ] æ–‡æ¡£å·²æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰

---

**é‡è¦æé†’**: ä¸¥æ ¼æŒ‰ç…§æ­¤æµç¨‹æ‰§è¡Œï¼Œé¿å…ç‰ˆæœ¬å·ä¸ä¸€è‡´çš„é—®é¢˜ï¼
